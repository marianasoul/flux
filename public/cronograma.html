<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MedStudios - Cronograma</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 2rem;
    }
    .header {
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      padding: 1rem 2rem;
      margin-bottom: 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .logo h1 {
      color: #2563eb;
      font-size: 1.8rem;
    }
    .nav-links {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .nav-link {
      text-decoration: none;
      color: #64748b;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      transition: all 0.3s;
      font-weight: 500;
    }
    .nav-link:hover {
      background-color: #f1f5f9;
      color: #2563eb;
    }
    .nav-link.active {
      background-color: #2563eb;
      color: white;
    }
    .container {
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      padding: 2rem;
    }
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .page-title {
      color: #334155;
      font-size: 2rem;
      margin: 0;
    }
    .add-btn {
      background-color: #2563eb;
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .add-btn:hover {
      background-color: #1d4ed8;
      transform: translateY(-2px);
    }
    .form-container {
      background-color: #f8fafc;
      border-radius: 10px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      display: none;
    }
    .form-container.active {
      display: block;
    }
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .form-group {
      display: flex;
      flex-direction: column;
    }
    .form-group label {
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: #334155;
    }
    .form-group input,
    .form-group select {
      padding: 0.75rem;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.3s;
    }
    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #2563eb;
    }
    .form-actions {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
    }
    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }
    .btn-primary {
      background-color: #2563eb;
      color: white;
    }
    .btn-primary:hover {
      background-color: #1d4ed8;
    }
    .btn-secondary {
      background-color: #64748b;
      color: white;
    }
    .btn-secondary:hover {
      background-color: #475569;
    }
    .schedule-container {
      overflow-x: auto;
    }
    .schedule-table {
      width: 100%;
      border-collapse: collapse;
      min-width: 800px;
    }
    .schedule-table th,
    .schedule-table td {
      border: 1px solid #e2e8f0;
      padding: 0.75rem;
      text-align: center;
      vertical-align: top;
    }
    .schedule-table th {
      background-color: #f8fafc;
      font-weight: 600;
      color: #334155;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .time-slot {
      background-color: #f1f5f9;
      font-weight: 600;
      color: #475569;
      min-width: 100px;
    }
    .lesson-cell {
      position: relative;
      height: 80px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .lesson-cell:hover {
      background-color: #f8fafc;
    }
    .lesson-item {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 0.5rem;
      border-radius: 6px;
      font-size: 0.9rem;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      position: relative;
      cursor: pointer;
      transition: transform 0.3s;
    }
    .lesson-item:hover {
      transform: scale(1.02);
    }
    .lesson-subject {
      font-weight: 600;
      margin-bottom: 0.25rem;
    }
    .lesson-professor {
      font-size: 0.8rem;
      opacity: 0.9;
    }
    .lesson-room {
      font-size: 0.8rem;
      opacity: 0.8;
      margin-top: 0.25rem;
    }
    .lesson-actions {
      position: absolute;
      top: 2px;
      right: 2px;
      display: none;
      gap: 2px;
    }
    .lesson-item:hover .lesson-actions {
      display: flex;
    }
    .action-btn {
      background-color: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 20px;
      height: 20px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 0.7rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .action-btn:hover {
      background-color: rgba(255, 255, 255, 0.3);
    }
    .empty-state {
      text-align: center;
      padding: 3rem;
      color: #64748b;
    }
    .empty-state .icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }
    .week-navigation {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      margin-bottom: 2rem;
    }
    .week-nav-btn {
      background-color: #f1f5f9;
      border: 1px solid #e2e8f0;
      color: #475569;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .week-nav-btn:hover {
      background-color: #e2e8f0;
    }
    .current-week {
      font-weight: 600;
      color: #334155;
    }
    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
      }
      .nav-links {
        justify-content: center;
      }
      body {
        padding: 1rem;
      }
      .page-header {
        flex-direction: column;
        align-items: stretch;
      }
      .form-grid {
        grid-template-columns: 1fr;
      }
      .schedule-table th,
      .schedule-table td {
        padding: 0.5rem;
        font-size: 0.9rem;
      }
      .lesson-item {
        font-size: 0.8rem;
        padding: 0.25rem;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo">
      <h1>üìö MedStudios</h1>
    </div>
    <div class="nav-links">
      <a href="/" class="nav-link">üè† In√≠cio</a>
      <a href="/cronograma" class="nav-link active">üìÖ Cronograma</a>
      <a href="/agenda" class="nav-link">üìù Agenda</a>
      <a href="/planejamento" class="nav-link">üìö Planejamento</a>
      <a href="/progresso" class="nav-link">üìä Progresso</a>
      <a href="/disciplinas" class="nav-link">üìñ Disciplinas</a>
      <a href="/professores" class="nav-link">üë®‚Äçüè´ Professores</a>
      <a href="/semestre" class="nav-link">üóìÔ∏è Semestre</a>
    </div>
  </div>

  <div class="container">
    <div class="page-header">
      <h1 class="page-title">üìÖ Cronograma Semanal</h1>
      <button class="add-btn" onclick="toggleForm()">
        <span>‚ûï</span>
        Nova Aula
      </button>
    </div>

    <div class="form-container" id="lessonForm">
      <form onsubmit="addLesson(event)">
        <div class="form-grid">
          <div class="form-group">
            <label for="subject">Disciplina</label>
            <select id="subject" name="subject" required>
              <option value="">Selecione uma disciplina</option>
            </select>
          </div>
          <div class="form-group">
            <label for="professor">Professor</label>
            <select id="professor" name="professor" required>
              <option value="">Selecione um professor</option>
            </select>
          </div>
          <div class="form-group">
            <label for="dayOfWeek">Dia da Semana</label>
            <select id="dayOfWeek" name="dayOfWeek" required>
              <option value="monday">Segunda-feira</option>
              <option value="tuesday">Ter√ßa-feira</option>
              <option value="wednesday">Quarta-feira</option>
              <option value="thursday">Quinta-feira</option>
              <option value="friday">Sexta-feira</option>
              <option value="saturday">S√°bado</option>
            </select>
          </div>
          <div class="form-group">
            <label for="startTime">Hor√°rio de In√≠cio</label>
            <input type="time" id="startTime" name="startTime" required>
          </div>
          <div class="form-group">
            <label for="endTime">Hor√°rio de T√©rmino</label>
            <input type="time" id="endTime" name="endTime" required>
          </div>
          <div class="form-group">
            <label for="room">Sala</label>
            <input type="text" id="room" name="room" placeholder="Ex: Sala 101" required>
          </div>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" onclick="toggleForm()">Cancelar</button>
          <button type="submit" class="btn btn-primary">Adicionar Aula</button>
        </div>
      </form>
    </div>

    <div class="week-navigation">
      <button class="week-nav-btn" onclick="changeWeek(-1)">‚Üê Semana Anterior</button>
      <span class="current-week" id="currentWeek">Semana Atual</span>
      <button class="week-nav-btn" onclick="changeWeek(1)">Pr√≥xima Semana ‚Üí</button>
    </div>

    <div class="schedule-container">
      <table class="schedule-table" id="scheduleTable">
        <thead>
          <tr>
            <th class="time-slot">Hor√°rio</th>
            <th>Segunda</th>
            <th>Ter√ßa</th>
            <th>Quarta</th>
            <th>Quinta</th>
            <th>Sexta</th>
            <th>S√°bado</th>
          </tr>
        </thead>
        <tbody id="scheduleBody">
          <!-- Hor√°rios ser√£o gerados aqui -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    let lessons = [];
    let subjects = [];
    let professors = [];
    let editingLessonId = null;
    let currentWeekOffset = 0;

    const timeSlots = [
      '07:00', '08:00', '09:00', '10:00', '11:00', '12:00',
      '13:00', '14:00', '15:00', '16:00', '17:00', '18:00',
      '19:00', '20:00', '21:00', '22:00'
    ];

    const dayNames = {
      monday: 'Segunda',
      tuesday: 'Ter√ßa',
      wednesday: 'Quarta',
      thursday: 'Quinta',
      friday: 'Sexta',
      saturday: 'S√°bado'
    };

    // Carregar disciplinas
    async function loadSubjects() {
      try {
        const response = await fetch('/api/disciplinas');
        subjects = await response.json();
        
        const subjectSelect = document.getElementById('subject');
        subjectSelect.innerHTML = '<option value="">Selecione uma disciplina</option>';
        
        subjects.forEach(subject => {
          const option = document.createElement('option');
          option.value = subject.id;
          option.textContent = `${subject.name} (${subject.code})`;
          subjectSelect.appendChild(option);
        });
      } catch (error) {
        console.error('Erro ao carregar disciplinas:', error);
      }
    }

    // Carregar professores
    async function loadProfessors() {
      try {
        const response = await fetch('/api/professores');
        professors = await response.json();
        
        const professorSelect = document.getElementById('professor');
        professorSelect.innerHTML = '<option value="">Selecione um professor</option>';
        
        professors.forEach(professor => {
          const option = document.createElement('option');
          option.value = professor.id;
          option.textContent = `${professor.name} - ${professor.department}`;
          professorSelect.appendChild(option);
        });
      } catch (error) {
        console.error('Erro ao carregar professores:', error);
      }
    }

    // Carregar aulas
    async function loadLessons() {
      try {
        const response = await fetch('/api/cronograma');
        lessons = await response.json();
        renderSchedule();
      } catch (error) {
        console.error('Erro ao carregar aulas:', error);
        renderSchedule();
      }
    }

    // Renderizar cronograma
    function renderSchedule() {
      const scheduleBody = document.getElementById('scheduleBody');
      scheduleBody.innerHTML = '';

      timeSlots.forEach(time => {
        const row = document.createElement('tr');
        
        // C√©lula do hor√°rio
        const timeCell = document.createElement('td');
        timeCell.className = 'time-slot';
        timeCell.textContent = time;
        row.appendChild(timeCell);

        // C√©lulas dos dias da semana
        Object.keys(dayNames).forEach(day => {
          const cell = document.createElement('td');
          cell.className = 'lesson-cell';
          cell.onclick = () => addLessonToSlot(day, time);
          
          // Buscar aula para este hor√°rio e dia
          const lesson = lessons.find(l => 
            l.dayOfWeek === day && 
            l.startTime <= time && 
            l.endTime > time
          );

          if (lesson) {
            const subject = subjects.find(s => s.id === parseInt(lesson.subject));
            const professor = professors.find(p => p.id === parseInt(lesson.professor));
            
            cell.innerHTML = `
              <div class="lesson-item" style="background-color: ${subject?.color || '#667eea'}">
                <div class="lesson-actions">
                  <button class="action-btn" onclick="event.stopPropagation(); editLesson(${lesson.id})" title="Editar">
                    ‚úèÔ∏è
                  </button>
                  <button class="action-btn" onclick="event.stopPropagation(); deleteLesson(${lesson.id})" title="Excluir">
                    üóëÔ∏è
                  </button>
                </div>
                <div class="lesson-subject">${subject?.name || 'Disciplina'}</div>
                <div class="lesson-professor">${professor?.name || 'Professor'}</div>
                <div class="lesson-room">${lesson.room}</div>
              </div>
            `;
          }
          
          row.appendChild(cell);
        });
        
        scheduleBody.appendChild(row);
      });
    }

    // Alternar formul√°rio
    function toggleForm() {
      const form = document.getElementById('lessonForm');
      const isActive = form.classList.contains('active');
      
      if (isActive) {
        form.classList.remove('active');
        resetForm();
      } else {
        form.classList.add('active');
      }
    }

    // Resetar formul√°rio
    function resetForm() {
      document.querySelector('#lessonForm form').reset();
      editingLessonId = null;
      document.querySelector('.btn-primary').textContent = 'Adicionar Aula';
    }

    // Adicionar aula a um slot espec√≠fico
    function addLessonToSlot(day, time) {
      document.getElementById('dayOfWeek').value = day;
      document.getElementById('startTime').value = time;
      
      // Calcular hor√°rio de t√©rmino (1 hora depois)
      const [hours, minutes] = time.split(':');
      const endHour = String(parseInt(hours) + 1).padStart(2, '0');
      document.getElementById('endTime').value = `${endHour}:${minutes}`;
      
      toggleForm();
    }

    // Adicionar/Editar aula
    async function addLesson(event) {
      event.preventDefault();
      
      const formData = new FormData(event.target);
      const lessonData = {
        subject: formData.get('subject'),
        professor: formData.get('professor'),
        dayOfWeek: formData.get('dayOfWeek'),
        startTime: formData.get('startTime'),
        endTime: formData.get('endTime'),
        room: formData.get('room')
      };

      try {
        let response;
        if (editingLessonId) {
          response = await fetch(`/api/cronograma/${editingLessonId}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(lessonData)
          });
        } else {
          response = await fetch('/api/cronograma', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(lessonData)
          });
        }

        if (response.ok) {
          toggleForm();
          loadLessons();
        } else {
          alert('Erro ao salvar aula');
        }
      } catch (error) {
        console.error('Erro ao salvar aula:', error);
        alert('Erro ao salvar aula');
      }
    }

    // Editar aula
    function editLesson(id) {
      const lesson = lessons.find(l => l.id === id);
      if (!lesson) return;

      editingLessonId = id;
      
      document.getElementById('subject').value = lesson.subject;
      document.getElementById('professor').value = lesson.professor;
      document.getElementById('dayOfWeek').value = lesson.dayOfWeek;
      document.getElementById('startTime').value = lesson.startTime;
      document.getElementById('endTime').value = lesson.endTime;
      document.getElementById('room').value = lesson.room;
      
      document.querySelector('.btn-primary').textContent = 'Atualizar Aula';
      document.getElementById('lessonForm').classList.add('active');
    }

    // Excluir aula
    async function deleteLesson(id) {
      if (!confirm('Tem certeza que deseja excluir esta aula?')) return;

      try {
        const response = await fetch(`/api/cronograma/${id}`, {
          method: 'DELETE'
        });

        if (response.ok) {
          loadLessons();
        } else {
          alert('Erro ao excluir aula');
        }
      } catch (error) {
        console.error('Erro ao excluir aula:', error);
        alert('Erro ao excluir aula');
      }
    }

    // Navegar entre semanas
    function changeWeek(direction) {
      currentWeekOffset += direction;
      updateWeekDisplay();
    }

    // Atualizar exibi√ß√£o da semana
    function updateWeekDisplay() {
      const currentWeekElement = document.getElementById('currentWeek');
      const today = new Date();
      const weekStart = new Date(today);
      weekStart.setDate(today.getDate() + (currentWeekOffset * 7) - today.getDay() + 1);
      
      const weekEnd = new Date(weekStart);
      weekEnd.setDate(weekStart.getDate() + 5);
      
      const formatDate = (date) => {
        return date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' });
      };
      
      currentWeekElement.textContent = `${formatDate(weekStart)} - ${formatDate(weekEnd)}`;
    }

    // Inicializar p√°gina
    document.addEventListener('DOMContentLoaded', () => {
      loadSubjects();
      loadProfessors();
      loadLessons();
      updateWeekDisplay();
    });
  </script>
</body>
</html>